<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KridArt Engine</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">
            <h1>KridArt Engine</h1>
        </div>
        <nav>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#projects">Projects</a></li>
                <li><a href="#gallery">Gallery</a></li>
                <li><a href="#resources">Resources</a></li>
                <li><a href="#community">Community</a></li>
                <li><a href="#login">Login</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="home">
            <div class="home-content">
                <h2>Welcome to KridArt Engine</h2>
                <p>A powerful platform for creating, managing, and sharing 3D assets and projects directly in your browser.</p>
                <button class="primary-btn" onclick="startEngine()">Launch Engine</button>
            </div>
            <div class="home-illustration">
                <img src="illustration.png" alt="KridArt Illustration">
            </div>
        </section>

        <section id="projects">
            <h2>My Projects</h2>
            <div class="project-container">
                <button class="new-project-btn" onclick="createNewProject()">+ New Project</button>
                <!-- Dynamically populated project thumbnails -->
            </div>
        </section>

        <section id="gallery">
            <h2>Gallery</h2>
            <div class="gallery-container">
                <canvas id="galleryCanvas"></canvas>
            </div>
        </section>

        <section id="resources">
            <h2>Resources</h2>
            <ul class="resources-list">
                <li><a href="#">Documentation</a></li>
                <li><a href="#">Tutorials</a></li>
                <li><a href="#">Community Assets</a></li>
            </ul>
        </section>

        <section id="community">
            <h2>Community</h2>
            <p>Connect with other creators, share your work, and collaborate on projects.</p>
            <div class="community-chat">
                <textarea id="chatInput" placeholder="Type your message here..."></textarea>
                <button class="send-message-btn" onclick="sendMessage()">Send</button>
                <div id="chatMessages" class="chat-messages"></div>
            </div>
        </section>

        <section id="login">
            <h2>Login</h2>
            <form action="/api/login" method="POST" class="login-form">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>

                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>

                <button class="primary-btn" type="submit">Login</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 KridArt Engine. All rights reserved.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
    <script src="scripts.js"></script>
    <script>
        async function startEngine() {
            const canvas = document.getElementById('galleryCanvas');
            const gl = canvas.getContext('webgl');

            if (!gl) {
                alert('WebGL not supported, please use a modern browser.');
                return;
            }

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas });

            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            document.body.appendChild(renderer.domElement);

            const geometry = new THREE.BoxGeometry();
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            const cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                cube.rotation.x += 0.01;
                cube.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        }

        async function createNewProject() {
            try {
                const response = await fetch('/api/projects', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: 'New Project', date: new Date() }),
                });

                const data = await response.json();
                if (data.success) {
                    const projectContainer = document.querySelector('.project-container');
                    const newProject = document.createElement('div');
                    newProject.className = 'project-thumbnail';
                    newProject.textContent = 'New Project';
                    projectContainer.appendChild(newProject);
                } else {
                    alert('Error creating project.');
                }
            } catch (error) {
                alert('An error occurred while creating the project: ' + error.message);
            }
        }

        async function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatMessages = document.getElementById('chatMessages');
            const message = chatInput.value;

            if (message.trim()) {
                try {
                    const response = await fetch('/api/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ message }),
                    });

                    const data = await response.json();

                    if (data.success) {
                        const messageElement = document.createElement('div');
                        messageElement.textContent = message;
                        chatMessages.appendChild(messageElement);
                        chatInput.value = '';
                    } else {
                        alert('Error sending message.');
                    }
                } catch (error) {
                    alert('An error occurred while sending the message: ' + error.message);
                }
            }
        }
    </script>
</body>
</html>
